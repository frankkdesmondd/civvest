generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String                  @id @default(uuid())
  email               String                  @unique
  password            String
  resetToken          String?
  resetTokenExp       DateTime?
  accountNumber       String                  @unique
  balance             Float                   @default(0)
  createdAt           DateTime                @default(now())
  firstName           String
  lastName            String
  role                Role                    @default(USER)
  updatedAt           DateTime                @updatedAt
  accountName         String?
  address             String?
  bankAccountNumber   String?
  bankName            String?
  country             String?
  phone               String?
  profilePicture      String?
  referralBonus       Float                   @default(0)
  referralCount       Int                     @default(0)
  referralCode        String?
  referredBy          String?
  roi                 Float                   @default(0)
  routingCode         String?
  state               String?
  deposits            Deposit[]               @relation("UserDeposits")
  applications        InvestmentApplication[] @relation("UserApplications")
  messages            Message[]               @relation("SentMessages")
  notifications       Notification[]
  roiTransactions     ROITransaction[]
  transfers           Transfer[]              @relation("UserTransfers")
  userInvestments     UserInvestment[]
  wallets             Wallet[]                @relation("UserWallets")
  approvedWithdrawals Withdrawal[]            @relation("WithdrawalApprovals")
  withdrawals         Withdrawal[]
}

model Wallet {
  id            String   @id @default(uuid())
  userId        String
  coinHost      String
  walletAddress String
  createdAt     DateTime @default(now())
  user          User     @relation("UserWallets", fields: [userId], references: [id], onDelete: Cascade)
}

model ReferralWithdrawal {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  amount        Float
  type          String   // 'BANK_TRANSFER' or 'CRYPTO_WALLET'
  status        String   @default("PENDING") // 'PENDING', 'APPROVED', 'REJECTED', 'PROCESSED'
  
  // Bank details
  bankName      String?
  accountName   String?
  accountNumber String?
  routingCode   String?
  
  // Crypto details
  coinHost      String?
  walletAddress String?
  
  adminNotes    String?
  approvedById  String?
  approvedBy    User?    @relation("ReferralWithdrawalApprover", fields: [approvedById], references: [id])
  approvedAt    DateTime?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Deposit {
  id           String     @id @default(uuid())
  userId       String
  investmentId String
  amount       Float
  network      String
  receiptUrl   String?
  status       String     @default("PENDING")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  investment   Investment @relation(fields: [investmentId], references: [id])
  user         User       @relation("UserDeposits", fields: [userId], references: [id], onDelete: Cascade)
}

model Investment {
  id              String                  @id @default(uuid())
  title           String
  slug            String                  @unique
  description     String
  shortDesc       String
  imageUrl        String
  minAmount       Float
  targetAmount    Float
  currentAmount   Float                   @default(0)
  returnRate      String
  duration        String
  category        String
  featured        Boolean                 @default(false)
  status          InvestmentStatus        @default(ACTIVE)
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  bondOffering    Boolean                 @default(false)
  deposits        Deposit[]
  applications    InvestmentApplication[] @relation("InvestmentApplications")
  userInvestments UserInvestment[]
}

model InvestmentApplication {
  id           String            @id @default(uuid())
  firstName    String
  lastName     String
  email        String
  phoneNumber  String
  amount       Float
  message      String?
  status       ApplicationStatus @default(PENDING)
  userId       String?
  investmentId String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  investment   Investment        @relation("InvestmentApplications", fields: [investmentId], references: [id])
  user         User?             @relation("UserApplications", fields: [userId], references: [id])
  messages     Message[]
}

model NewsPost {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  content   String
  excerpt   String
  imageUrl  String
  category  String
  author    String
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserInvestment {
  id              String           @id @default(uuid())
  userId          String
  investmentId    String
  amount          Float
  returnAmount    Float
  startDate       DateTime?
  endDate         DateTime?
  status          String           @default("PENDING")
  createdAt       DateTime         @default(now())
  depositId       String?
  roiAmount       Float            @default(0)
  totalRoiAdded   Float            @default(0)
  roiTransactions ROITransaction[]
  investment      Investment       @relation(fields: [investmentId], references: [id])
  user            User             @relation(fields: [userId], references: [id])
  withdrawals     Withdrawal[]
}

model ROITransaction {
  id                String         @id @default(cuid())
  userId            String
  userInvestmentId  String
  amount            Float
  type              String
  adminId           String?
  previousRoiAmount Float
  newRoiAmount      Float
  previousUserRoi   Float
  newUserRoi        Float
  notes             String?
  createdAt         DateTime       @default(now())
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userInvestment    UserInvestment @relation(fields: [userInvestmentId], references: [id], onDelete: Cascade)
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  read      Boolean  @default(false)
  type      String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Message {
  id            String                @id @default(uuid())
  applicationId String
  senderId      String
  senderRole    String
  content       String
  read          Boolean               @default(false)
  createdAt     DateTime              @default(now())
  application   InvestmentApplication @relation(fields: [applicationId], references: [id])
  sender        User                  @relation("SentMessages", fields: [senderId], references: [id])
}

model Transfer {
  id            String   @id @default(uuid())
  userId        String
  amount        Float
  receiptUrl    String
  accountNumber String
  bankName      String
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation("UserTransfers", fields: [userId], references: [id], onDelete: Cascade)
}

model Withdrawal {
  id               String           @id @default(uuid())
  userId           String
  userInvestmentId String
  amount           Float
  type             WithdrawalType
  status           WithdrawalStatus @default(PENDING)
  bankName         String?
  accountName      String?
  accountNumber    String?
  routingCode      String?
  coinHost         String?
  walletAddress    String?
  approvedById     String?
  approvedAt       DateTime?
  adminNotes       String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  approvedBy       User?            @relation("WithdrawalApprovals", fields: [approvedById], references: [id])
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  investment       UserInvestment   @relation(fields: [userInvestmentId], references: [id], onDelete: Cascade)
}

model ContactSubmission {
  id                 String   @id @default(uuid())
  name               String
  email              String
  phone              String
  message            String?
  accreditedInvestor Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

enum Role {
  USER
  ADMIN
}

enum InvestmentStatus {
  ACTIVE
  CLOSED
  COMING_SOON
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum WithdrawalType {
  BANK_TRANSFER
  CRYPTO_WALLET
}

enum WithdrawalStatus {
  PENDING
  APPROVED
  REJECTED
  PROCESSED
  FAILED
}
